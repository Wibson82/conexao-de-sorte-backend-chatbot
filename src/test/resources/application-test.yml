# ===============================================================================
# TEST CONFIGURATION - Spring Boot 3.5.5 Compatible
# ===============================================================================

spring:
  application:
    name: conexao-de-sorte-chatbot-test
    
  # R2DBC Configuration for Tests (H2 with PostgreSQL mode)
  r2dbc:
    url: r2dbc:h2:mem:///jogo_bicho_test;DB_CLOSE_DELAY=-1;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;DEFAULT_NULL_ORDERING=HIGH
    username: sa
    password: ""
    pool:
      initial-size: 1
      max-size: 5
    
  # Disable Flyway for tests
  flyway:
    enabled: false
    
  # Security Configuration for Tests
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:8081/.well-known/jwks.json
          issuer-uri: http://localhost:8081
          
  # Redis Configuration for Tests
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 1s
      lettuce:
        pool:
          max-active: 2
          max-idle: 1
          min-idle: 0

  # Jackson configuration for tests
  jackson:
    time-zone: America/Sao_Paulo
    locale: pt_BR
    default-property-inclusion: non_null

# Server configuration for tests
server:
  port: 0  # Random port for tests
  error:
    include-message: always
    include-binding-errors: on_param
    include-stacktrace: on_param
    include-exception: false

# Jogo do Bicho configuration for tests
jogo-bicho:
  apostas:
    horarios-permitidos: []  # Allow betting at any time in tests
    valor-minimo: 1.00
    valor-maximo: 1000.00
    limite-diario-usuario: 5000.00
  seguranca:
    validacao-integridade: false  # Simplify for tests
    auditoria-apostas: false
    limite-tentativas-falhas: 10
    bloqueio-temporario: 1s
    
# CORS configuration for tests
cors:
  allowed-origins: http://localhost:3000,http://localhost:8080
  allowed-methods: GET,POST,PUT,DELETE,OPTIONS
  allow-credentials: true

# Rate limiting disabled for tests
rate-limit:
  enabled: false

# Actuator configuration for tests
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
      show-components: always
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true

# Logging configuration for tests
logging:
  level:
    root: WARN
    "[br.tec.facilitaservicos.chatbot]": DEBUG
    "[org.springframework.r2dbc]": INFO
    "[org.springframework.security]": INFO
    "[org.springframework.web.reactive]": INFO
    "[org.springframework.test]": INFO
  pattern:
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"

# SpringDoc configuration for tests
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false